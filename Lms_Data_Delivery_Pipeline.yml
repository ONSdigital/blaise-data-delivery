parameters:
  - name : VarGroup
    displayName: Variable Group
  - name: Environment
    displayName: Environment to use

trigger:
- none

pr:
- none

variables:
  - group: ${{ parameters.VarGroup }}
  - name: ServerParkName
    value: gusty
  - name: SurveyType
    value: LMS
  - name: PackageExtension
    value: zip
  - name: TempPath
    value: c:\blaise\temp\datadelivery\lms

stages:
  - stage: DataDelivery
    displayName: Lms Data Delivery
    variables:
      ENV_RESTAPI_URL : http://localhost:90
    jobs:
      - deployment: LmsDeliveryData
        environment:
          name: ${{parameters.Environment}}
          resourceType: virtualMachine
          tags: restapi
        strategy:
        runOnce:
          deploy: 
            steps:
              - checkout: self

              - task: PowerShell@2
                displayName: Deliver LMS Instruments
                inputs:
                  filePath: '$(Agent.BuildDirectory)/s/scripts/lms/DeliverLmsInstruments.ps1'

              - task: PowerShell@2
                displayName: Clean up temp folders
                inputs:
                targetType: 'inline'
                script: |
                  Remove-Item -Recurse -Force $env:TempPath
